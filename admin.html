<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin ¬∑ Doce Lagom</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;600&family=Montserrat:wght@200;400;600&display=swap" rel="stylesheet">
    <style>
        /* ===== CORE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        :root {
            --creme-fundo: #FDFCF9;
            --terroso-luxo: #94745B;
            --menta-seco: #8FA38B;
            --texto: #3E3B39;
            --branco: #FFFFFF;
            --bege-claro: #F4F1ED;
            --cinza-claro: #E8E6E1;
            --esgotado: #E63946;
        }

        body {
            background: var(--creme-fundo);
            color: var(--texto);
            display: flex;
            min-height: 100vh;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: var(--branco);
            border-right: 1px solid var(--bege-claro);
            padding: 40px 25px;
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
        }

        .logo {
            text-align: center;
            margin-bottom: 50px;
        }

        .logo img {
            max-width: 120px;
            border-radius: 50%;
            margin-bottom: 10px;
        }

        .logo h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            color: var(--terroso-luxo);
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 20px;
            border-radius: 50px;
            color: var(--texto);
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 1px;
            margin-bottom: 8px;
            transition: 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--bege-claro);
        }

        .nav-item.active {
            background: var(--terroso-luxo);
            color: white;
        }

        .nav-item i {
            font-style: normal;
            font-size: 1.1rem;
        }

        /* ===== MAIN ===== */
        .main {
            flex: 1;
            padding: 40px;
            background: var(--creme-fundo);
            overflow-x: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            color: var(--terroso-luxo);
        }

        .btn {
            background: var(--terroso-luxo);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            cursor: pointer;
            transition: 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            opacity: 0.9;
            transform: scale(0.98);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--terroso-luxo);
            color: var(--terroso-luxo);
        }

        .btn-esgotado {
            background: var(--esgotado);
        }

        /* ===== CARDS PRODUTO ===== */
        .produtos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .produto-card {
            background: white;
            border-radius: 16px;
            border: 1px solid var(--bege-claro);
            padding: 20px;
            transition: 0.2s;
        }

        .produto-header {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .produto-img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            background: #f5f5f5;
        }

        .produto-info {
            flex: 1;
        }

        .produto-nome {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--terroso-luxo);
            margin-bottom: 4px;
        }

        .produto-categoria {
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--menta-seco);
            letter-spacing: 1px;
        }

        .produto-desc {
            font-size: 0.8rem;
            color: #666;
            margin: 10px 0;
        }

        .variacao-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
            margin: 15px 0;
        }

        .variacao-table td {
            padding: 8px 0;
            border-bottom: 1px dashed var(--bege-claro);
        }

        .estoque-badge {
            background: var(--bege-claro);
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .esgotado-badge {
            background: var(--esgotado);
            color: white;
            padding: 4px 10px;
            border-radius: 50px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .acoes {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }

        .btn-pequeno {
            padding: 8px 16px;
            font-size: 0.7rem;
        }

        /* ===== ESTOQUE ===== */
        .estoque-list {
            background: white;
            border-radius: 16px;
            padding: 20px;
        }

        .estoque-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--bege-claro);
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: var(--bege-claro);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--terroso-luxo);
            border-radius: 10px;
        }

        /* ===== PEDIDOS ===== */
        .pedidos-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .pedido-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            border-left: 5px solid var(--menta-seco);
        }

        .pedido-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .status {
            font-size: 0.65rem;
            padding: 4px 12px;
            border-radius: 50px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.pendente { background: #FFE4B5; color: #8B4513; }
        .status.concluido { background: #C1E1C1; color: #2F4F4F; }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .modal-content {
            background: white;
            padding: 35px;
            border-radius: 24px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            color: var(--terroso-luxo);
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--texto);
            text-transform: uppercase;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--bege-claro);
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .variacao-item {
            background: var(--bege-claro);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        /* ===== UTILS ===== */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--terroso-luxo);
            color: white;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 0.85rem;
            z-index: 10000;
            display: none;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 900px) {
            body { flex-direction: column; }
            .sidebar { width: 100%; height: auto; position: relative; }
        }
    </style>
</head>
<body>

<!-- NOTIFICA√á√ÉO FLUTUANTE -->
<div id="notification" class="notification"></div>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="logo">
        <img src="https://i.pinimg.com/originals/54/2c/45/542c4582ca79a683b61ad28f926f9efd.png" alt="Doce Lagom">
        <h1>Doce Lagom</h1>
        <p style="font-size: 0.7rem; color: var(--menta-seco); letter-spacing: 2px; margin-top: 5px;">ADMIN</p>
    </div>

    <div id="navProdutos" class="nav-item active" onclick="mudarSecao('produtos')">
        <i>üç∞</i> PRODUTOS
    </div>
    <div id="navEstoque" class="nav-item" onclick="mudarSecao('estoque')">
        <i>üì¶</i> ESTOQUE
    </div>
    <div id="navPedidos" class="nav-item" onclick="mudarSecao('pedidos')">
        <i>üìã</i> PEDIDOS
    </div>
    <div id="navConfig" class="nav-item" onclick="mudarSecao('config')">
        <i>‚öôÔ∏è</i> CONFIGURA√á√ïES
    </div>

    <div style="margin-top: 50px; padding: 20px 0; border-top: 1px solid var(--bege-claro);">
        <div style="display: flex; gap: 15px; align-items: center;">
            <div style="background: var(--bege-claro); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">üë§</div>
            <div>
                <p style="font-weight: 600; font-size: 0.85rem;">Admin</p>
                <p style="font-size: 0.65rem; color: #777;">gestor@docelagom</p>
            </div>
        </div>
    </div>
</div>

<!-- CONTE√öDO PRINCIPAL -->
<div class="main">
    <!-- SE√á√ÉO PRODUTOS -->
    <div id="secaoProdutos" class="section active">
        <div class="section-header">
            <h2>üç¨ Cat√°logo de Produtos</h2>
            <button class="btn" onclick="abrirModalProduto(null)">+ NOVO PRODUTO</button>
        </div>
        <div id="produtosContainer" class="produtos-grid">
            <!-- JS ir√° preencher -->
        </div>
    </div>

    <!-- SE√á√ÉO ESTOQUE -->
    <div id="secaoEstoque" class="section">
        <div class="section-header">
            <h2>üìä N√≠vel de Estoque</h2>
            <button class="btn btn-outline" onclick="resetarEstoqueGlobal()">ZERAR VENDAS</button>
        </div>
        <div id="estoqueContainer" class="estoque-list">
            <!-- JS ir√° preencher -->
        </div>
    </div>

    <!-- SE√á√ÉO PEDIDOS -->
    <div id="secaoPedidos" class="section">
        <div class="section-header">
            <h2>üì¶ Pedidos Recentes</h2>
            <button class="btn btn-outline" onclick="adicionarPedidoExemplo()">+ ADICIONAR EXEMPLO</button>
        </div>
        <div id="pedidosContainer" class="pedidos-list">
            <!-- JS ir√° preencher -->
        </div>
    </div>

    <!-- SE√á√ÉO CONFIGURA√á√ïES -->
    <div id="secaoConfig" class="section">
        <div class="section-header">
            <h2>‚öôÔ∏è Configura√ß√µes</h2>
        </div>
        <div style="background: white; border-radius: 16px; padding: 30px; max-width: 600px;">
            <h3 style="font-family: 'Cormorant Garamond'; color: var(--terroso-luxo); margin-bottom: 20px;">Limite padr√£o de produ√ß√£o</h3>
            <div class="form-group">
                <label>Estoque m√°ximo por item (unidades)</label>
                <input type="number" id="estoqueMaximoInput" class="form-control" value="10" min="1">
            </div>
            <button class="btn" onclick="salvarConfiguracoes()" style="margin-top: 10px;">SALVAR</button>
            <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--bege-claro);">
            <h3 style="font-family: 'Cormorant Garamond'; color: var(--terroso-luxo); margin-bottom: 20px;">Danger Zone</h3>
            <button class="btn" style="background: var(--esgotado);" onclick="resetarTudo()">APAGAR TODOS OS DADOS</button>
        </div>
    </div>
</div>

<!-- MODAL DE PRODUTO (CRIAR/EDITAR) -->
<div id="modalProduto" class="modal">
    <div class="modal-content">
        <h3 id="modalTitulo">Novo Produto</h3>
        <form id="formProduto">
            <input type="hidden" id="produtoId" value="">

            <div class="form-group">
                <label>Nome do produto</label>
                <input type="text" id="produtoNome" class="form-control" required>
            </div>

            <div class="form-group">
                <label>Descri√ß√£o</label>
                <textarea id="produtoDesc" class="form-control" rows="2"></textarea>
            </div>

            <div class="form-group">
                <label>Categoria</label>
                <select id="produtoCategoria" class="form-control">
                    <option value="trufas">Trufas</option>
                    <option value="bolos">Bolos de Pote</option>
                    <option value="combos">Combos</option>
                </select>
            </div>

            <div class="form-group">
                <label>URL da Imagem</label>
                <input type="url" id="produtoImagem" class="form-control" placeholder="https://...">
            </div>

            <div class="form-group">
                <label>Tipo de pre√ßo</label>
                <select id="tipoPreco" class="form-control" onchange="toggleVariacoes()">
                    <option value="unico">Pre√ßo √∫nico</option>
                    <option value="variacoes">M√∫ltiplos tamanhos (trufas)</option>
                </select>
            </div>

            <!-- √Årea para pre√ßo √∫nico -->
            <div id="precoUnicoArea">
                <div class="form-group">
                    <label>Pre√ßo (R$)</label>
                    <input type="number" id="produtoPreco" class="form-control" step="0.01" min="0">
                </div>
            </div>

            <!-- √Årea para varia√ß√µes (tamanhos) -->
            <div id="variacoesArea" style="display: none;">
                <label>Varia√ß√µes de tamanho e pre√ßo</label>
                <div id="variacoesContainer">
                    <!-- JS ir√° adicionar linhas -->
                </div>
                <button type="button" class="btn btn-outline" onclick="adicionarVariacao()" style="margin-top: 10px; width: 100%;">+ Adicionar tamanho</button>
            </div>

            <div class="form-group" style="margin-top: 25px;">
                <label>Badge / Destaque (opcional)</label>
                <input type="text" id="produtoBadge" class="form-control" placeholder="Favorito, Especial, etc">
            </div>

            <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                <button type="button" class="btn btn-outline" onclick="fecharModalProduto()">Cancelar</button>
                <button type="submit" class="btn">Salvar Produto</button>
            </div>
        </form>
    </div>
</div>

<script>
    // ============================================
    //  ADMIN DO LAGOM - GERENCIAMENTO COMPLETO
    // ============================================

    // ---------- CONSTANTES ----------
    const STORAGE_PRODUTOS = 'produtos_lagom';
    const STORAGE_ESTOQUE = 'estoque_lagom';
    const STORAGE_PEDIDOS = 'pedidos_lagom';
    const STORAGE_CONFIG = 'config_lagom';

    let ESTOQUE_MAX = 10; // valor padr√£o

    // ---------- DADOS INICIAIS ----------
    // Produtos padr√£o (caso n√£o existam no localStorage)
    const produtosPadrao = [
        {
            id: 'mar',
            nome: 'Maracuj√°',
            descricao: 'Trufa cremosa com recheio de maracuj√°, equilibrando do√ßura e acidez.',
            categoria: 'trufas',
            imagem: 'https://i.ibb.co/d4wBYTPT/b6e504dc-ee33-4c3e-9be3-721ed8f5c3b7.jpg',
            badge: 'Favorito',
            tipoPreco: 'variacoes',
            variacoes: [
                { tamanho: 'M√©dia', preco: 6, key: 'mar-m' },
                { tamanho: 'Mini', preco: 4, key: 'mar-mini' }
            ]
        },
        {
            id: 'ni',
            nome: 'Ninho & Nutella',
            descricao: 'Combina√ß√£o irresist√≠vel de leite Ninho com Nutella em uma trufa macia.',
            categoria: 'trufas',
            imagem: 'https://i.ibb.co/vCYCLvML/image.png',
            badge: 'Favorito',
            tipoPreco: 'variacoes',
            variacoes: [
                { tamanho: 'M√©dia', preco: 6, key: 'ni-m' },
                { tamanho: 'Mini', preco: 4, key: 'ni-mini' }
            ]
        },
        {
            id: 'pa',
            nome: 'Pa√ßoca',
            descricao: 'Trufa com o sabor cl√°ssico da pa√ßoca, crocante e irresist√≠vel.',
            categoria: 'trufas',
            imagem: 'https://i.ibb.co/JjrwS6gV/4e7c1bd3-101a-47cd-8f6c-dbbaf1f42caf.jpg',
            badge: '',
            tipoPreco: 'variacoes',
            variacoes: [
                { tamanho: 'M√©dia', preco: 6, key: 'pa-m' },
                { tamanho: 'Mini', preco: 4, key: 'pa-mini' }
            ]
        },
        {
            id: 'caf',
            nome: 'Caf√©',
            descricao: 'Trufa com intenso sabor de caf√©, perfeita para os amantes da bebida.',
            categoria: 'trufas',
            imagem: 'https://i.ibb.co/0jmQ2JwH/91d96de8-2f80-48fa-a370-7d775f17eb8d.jpg',
            badge: '',
            tipoPreco: 'variacoes',
            variacoes: [
                { tamanho: 'M√©dia', preco: 6, key: 'caf-m' },
                { tamanho: 'Mini', preco: 4, key: 'caf-mini' }
            ]
        },
        {
            id: 'bn',
            nome: 'Bolo Ninho & Nutella',
            descricao: 'Camadas de creme de Ninho com Nutella no pote, pura indulg√™ncia.',
            categoria: 'bolos',
            imagem: 'https://i.ibb.co/vxf8TJDv/Cantinho-da-G-Wordmark-Logo-1.png',
            badge: '',
            tipoPreco: 'unico',
            preco: 15,
            key: 'bn'
        },
        {
            id: 'bm',
            nome: 'Bolo Maracuj√°',
            descricao: 'Bolo de pote refrescante com creme de maracuj√° e massa fofinha.',
            categoria: 'bolos',
            imagem: 'https://i.ibb.co/gFXm5yhG/Cantinho-da-G-Wordmark-Logo.png',
            badge: '',
            tipoPreco: 'unico',
            preco: 15,
            key: 'bm'
        },
        {
            id: 'bc',
            nome: 'Bolo Chocolate',
            descricao: 'Bolo de pote de chocolate intenso, para os choc√≥latras de plant√£o.',
            categoria: 'bolos',
            imagem: 'https://i.ibb.co/wZkd0tZ8/image.png',
            badge: '',
            tipoPreco: 'unico',
            preco: 15,
            key: 'bc'
        },
        {
            id: 'kit',
            nome: 'Kit Degusta√ß√£o',
            descricao: '5 mini trufas sortidas.',
            categoria: 'combos',
            imagem: 'https://i.ibb.co/gFSmx2Cy/f1f2641a-3653-437d-b84f-52be0901330a.jpg',
            badge: 'Especial',
            tipoPreco: 'unico',
            preco: 15,
            key: 'kit'
        },
        {
            id: 'trio',
            nome: 'Combo Trio M√©dias',
            descricao: 'Escolha 3 trufas m√©dias dos nossos sabores favoritos.',
            categoria: 'combos',
            imagem: 'https://i.ibb.co/7xV904Pc/image.png',
            badge: 'Mais Pedido',
            tipoPreco: 'unico',
            preco: 15,
            key: 'trio'
        },
        {
            id: 'duo',
            nome: 'Duo Lagom',
            descricao: '1 bolo de pote + 1 trufa m√©dia, a combina√ß√£o perfeita.',
            categoria: 'combos',
            imagem: 'https://i.ibb.co/DfL33q2K/image.png',
            badge: 'Favorito',
            tipoPreco: 'unico',
            preco: 20,
            key: 'duo'
        }
    ];

    // ---------- INICIALIZA√á√ÉO ----------
    function inicializarDados() {
        // Carregar configura√ß√£o
        let config = JSON.parse(localStorage.getItem(STORAGE_CONFIG)) || {};
        ESTOQUE_MAX = config.estoqueMax || 10;
        document.getElementById('estoqueMaximoInput').value = ESTOQUE_MAX;

        // Produtos
        if (!localStorage.getItem(STORAGE_PRODUTOS)) {
            localStorage.setItem(STORAGE_PRODUTOS, JSON.stringify(produtosPadrao));
        }

        // Estoque
        if (!localStorage.getItem(STORAGE_ESTOQUE)) {
            localStorage.setItem(STORAGE_ESTOQUE, JSON.stringify({}));
        }

        // Pedidos
        if (!localStorage.getItem(STORAGE_PEDIDOS)) {
            localStorage.setItem(STORAGE_PEDIDOS, JSON.stringify([]));
        }

        renderizarProdutos();
        renderizarEstoque();
        renderizarPedidos();
    }

    // ---------- UTILIT√ÅRIOS ----------
    function mostrarNotificacao(msg, tipo = 'sucesso') {
        let notif = document.getElementById('notification');
        notif.style.background = tipo === 'erro' ? '#E63946' : '#94745B';
        notif.innerText = msg;
        notif.style.display = 'block';
        setTimeout(() => notif.style.display = 'none', 3000);
    }

    // ---------- PRODUTOS ----------
    function renderizarProdutos() {
        const produtos = JSON.parse(localStorage.getItem(STORAGE_PRODUTOS)) || [];
        const container = document.getElementById('produtosContainer');
        container.innerHTML = '';

        produtos.forEach(prod => {
            const card = document.createElement('div');
            card.className = 'produto-card';

            let variacoesHTML = '';
            let estoqueInfo = '';

            if (prod.tipoPreco === 'variacoes' && prod.variacoes) {
                let rows = '';
                prod.variacoes.forEach(varia => {
                    const vendidos = getEstoqueVendidos(varia.key);
                    const disponivel = vendidos < ESTOQUE_MAX ? 'Dispon√≠vel' : 'Esgotado';
                    const badgeClass = vendidos >= ESTOQUE_MAX ? 'esgotado-badge' : 'estoque-badge';
                    rows += `<tr>
                        <td>${varia.tamanho}</td>
                        <td>R$ ${varia.preco.toFixed(2)}</td>
                        <td><span class="${badgeClass}">${vendidos} / ${ESTOQUE_MAX}</span></td>
                    </tr>`;
                });
                variacoesHTML = `<table class="variacao-table">${rows}</table>`;
            } else {
                const vendidos = getEstoqueVendidos(prod.key);
                const badgeClass = vendidos >= ESTOQUE_MAX ? 'esgotado-badge' : 'estoque-badge';
                variacoesHTML = `<div style="display:flex; justify-content:space-between; margin:10px 0;">
                    <span>Pre√ßo √∫nico:</span>
                    <strong>R$ ${prod.preco.toFixed(2)}</strong>
                    <span class="${badgeClass}">${vendidos} / ${ESTOQUE_MAX}</span>
                </div>`;
            }

            card.innerHTML = `
                <div class="produto-header">
                    <img src="${prod.imagem || 'https://via.placeholder.com/80'}" class="produto-img" onerror="this.src='https://via.placeholder.com/80'">
                    <div class="produto-info">
                        <div class="produto-nome">${prod.nome}</div>
                        <span class="produto-categoria">${categoriaPtBr(prod.categoria)}</span>
                        ${prod.badge ? `<span style="background:var(--terroso-luxo); color:white; padding:2px 10px; border-radius:50px; font-size:0.6rem; display:inline-block; margin-top:5px;">${prod.badge}</span>` : ''}
                    </div>
                </div>
                <div class="produto-desc">${prod.descricao}</div>
                ${variacoesHTML}
                <div class="acoes">
                    <button class="btn btn-pequeno btn-outline" onclick="abrirModalProduto('${prod.id}')">Editar</button>
                    <button class="btn btn-pequeno" style="background:var(--esgotado);" onclick="removerProduto('${prod.id}')">Remover</button>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function getEstoqueVendidos(key) {
        let estoque = JSON.parse(localStorage.getItem(STORAGE_ESTOQUE)) || {};
        return estoque[key] || 0;
    }

    function categoriaPtBr(cat) {
        const map = { trufas: 'TRUFAS', bolos: 'BOLOS DE POTE', combos: 'COMBOS' };
        return map[cat] || cat;
    }

    // ---------- MODAL PRODUTO ----------
    let editandoProdutoId = null;

    window.abrirModalProduto = function(id) {
        editandoProdutoId = id;
        const modal = document.getElementById('modalProduto');
        document.getElementById('formProduto').reset();
        document.getElementById('variacoesContainer').innerHTML = '';

        if (id) {
            // Edi√ß√£o
            document.getElementById('modalTitulo').innerText = 'Editar Produto';
            const produtos = JSON.parse(localStorage.getItem(STORAGE_PRODUTOS));
            const prod = produtos.find(p => p.id === id);
            if (prod) {
                document.getElementById('produtoId').value = prod.id;
                document.getElementById('produtoNome').value = prod.nome || '';
                document.getElementById('produtoDesc').value = prod.descricao || '';
                document.getElementById('produtoCategoria').value = prod.categoria || 'trufas';
                document.getElementById('produtoImagem').value = prod.imagem || '';
                document.getElementById('produtoBadge').value = prod.badge || '';
                document.getElementById('tipoPreco').value = prod.tipoPreco || 'unico';

                if (prod.tipoPreco === 'unico') {
                    document.getElementById('precoUnicoArea').style.display = 'block';
                    document.getElementById('variacoesArea').style.display = 'none';
                    document.getElementById('produtoPreco').value = prod.preco || 0;
                } else {
                    document.getElementById('precoUnicoArea').style.display = 'none';
                    document.getElementById('variacoesArea').style.display = 'block';
                    if (prod.variacoes) {
                        prod.variacoes.forEach(v => adicionarVariacao(v.tamanho, v.preco, v.key));
                    }
                }
            }
        } else {
            // Novo
            document.getElementById('modalTitulo').innerText = 'Novo Produto';
            document.getElementById('produtoId').value = '';
            document.getElementById('precoUnicoArea').style.display = 'block';
            document.getElementById('variacoesArea').style.display = 'none';
            document.getElementById('tipoPreco').value = 'unico';
        }

        modal.style.display = 'flex';
    }

    window.fecharModalProduto = function() {
        document.getElementById('modalProduto').style.display = 'none';
    }

    window.toggleVariacoes = function() {
        const tipo = document.getElementById('tipoPreco').value;
        if (tipo === 'unico') {
            document.getElementById('precoUnicoArea').style.display = 'block';
            document.getElementById('variacoesArea').style.display = 'none';
        } else {
            document.getElementById('precoUnicoArea').style.display = 'none';
            document.getElementById('variacoesArea').style.display = 'block';
            if (document.getElementById('variacoesContainer').children.length === 0) {
                adicionarVariacao('M√©dia', 6, '');
                adicionarVariacao('Mini', 4, '');
            }
        }
    }

    window.adicionarVariacao = function(tamanho = '', preco = 0, key = '') {
        const container = document.getElementById('variacoesContainer');
        const div = document.createElement('div');
        div.className = 'variacao-item';
        div.innerHTML = `
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" placeholder="Tamanho" class="form-control" style="flex:1;" value="${tamanho}">
                <input type="number" placeholder="Pre√ßo" class="form-control" style="width:100px;" step="0.01" value="${preco}">
                <input type="text" placeholder="Chave (ex: mar-m)" class="form-control" style="flex:1;" value="${key}">
                <button type="button" onclick="this.parentElement.parentElement.remove()" style="background:transparent; border:none; font-size:1.3rem; cursor:pointer;">&times;</button>
            </div>
        `;
        container.appendChild(div);
    }

    // Salvar produto
    document.getElementById('formProduto').addEventListener('submit', function(e) {
        e.preventDefault();

        const id = document.getElementById('produtoId').value || gerarIdProduto(document.getElementById('produtoNome').value);
        const nome = document.getElementById('produtoNome').value;
        const descricao = document.getElementById('produtoDesc').value;
        const categoria = document.getElementById('produtoCategoria').value;
        const imagem = document.getElementById('produtoImagem').value;
        const badge = document.getElementById('produtoBadge').value;
        const tipoPreco = document.getElementById('tipoPreco').value;

        let produto = {
            id,
            nome,
            descricao,
            categoria,
            imagem,
            badge,
            tipoPreco
        };

        if (tipoPreco === 'unico') {
            produto.preco = parseFloat(document.getElementById('produtoPreco').value) || 0;
            produto.key = id; // chave para estoque
        } else {
            const variacoes = [];
            const itens = document.querySelectorAll('#variacoesContainer .variacao-item');
            itens.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const tamanho = inputs[0].value;
                const preco = parseFloat(inputs[1].value) || 0;
                let key = inputs[2].value;
                if (!key) key = `${id}-${tamanho.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '')}`;
                if (tamanho && preco > 0) {
                    variacoes.push({ tamanho, preco, key });
                }
            });
            produto.variacoes = variacoes;
        }

        let produtos = JSON.parse(localStorage.getItem(STORAGE_PRODUTOS)) || [];
        const index = produtos.findIndex(p => p.id === id);
        if (index !== -1) {
            produtos[index] = produto;
        } else {
            produtos.push(produto);
        }

        localStorage.setItem(STORAGE_PRODUTOS, JSON.stringify(produtos));
        mostrarNotificacao('Produto salvo com sucesso!');
        fecharModalProduto();
        renderizarProdutos();
        renderizarEstoque(); // Atualiza lista de estoque
    });

    function gerarIdProduto(nome) {
        return nome.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[^a-z0-9]/g, '-').substring(0, 20);
    }

    window.removerProduto = function(id) {
        if (confirm(`Tem certeza que deseja remover este produto?`)) {
            let produtos = JSON.parse(localStorage.getItem(STORAGE_PRODUTOS)) || [];
            produtos = produtos.filter(p => p.id !== id);
            localStorage.setItem(STORAGE_PRODUTOS, JSON.stringify(produtos));
            mostrarNotificacao('Produto removido');
            renderizarProdutos();
            renderizarEstoque();
        }
    }

    // ---------- ESTOQUE ----------
    function renderizarEstoque() {
        const estoque = JSON.parse(localStorage.getItem(STORAGE_ESTOQUE)) || {};
        const produtos = JSON.parse(localStorage.getItem(STORAGE_PRODUTOS)) || [];
        const container = document.getElementById('estoqueContainer');
        container.innerHTML = '<h3 style="margin-bottom:20px;">üìå Itens vendidos / Limite de produ√ß√£o</h3>';

        let lista = document.createElement('div');

        // Coletar todas as chaves de estoque a partir dos produtos
        let chaves = new Set();
        produtos.forEach(prod => {
            if (prod.tipoPreco === 'unico' && prod.key) chaves.add(prod.key);
            if (prod.variacoes) prod.variacoes.forEach(v => chaves.add(v.key));
        });

        // Adicionar tamb√©m chaves que existem no estoque mas n√£o nos produtos? Vamos listar todas.
        Object.keys(estoque).forEach(key => chaves.add(key));

        chaves = Array.from(chaves).sort();

        chaves.forEach(key => {
            const vendidos = estoque[key] || 0;
            const percent = Math.min((vendidos / ESTOQUE_MAX) * 100, 100);
            const nomeExibicao = key; // Podemos buscar nome do produto
            let nomeAmigavel = key;
            // Tenta achar um produto relacionado
            for (let prod of produtos) {
                if (prod.key === key) { nomeAmigavel = prod.nome; break; }
                if (prod.variacoes) {
                    let varEncontrada = prod.variacoes.find(v => v.key === key);
                    if (varEncontrada) { nomeAmigavel = `${prod.nome} (${varEncontrada.tamanho})`; break; }
                }
            }

            const item = document.createElement('div');
            item.className = 'estoque-item';
            item.innerHTML = `
                <div style="flex:2;">
                    <strong>${nomeAmigavel}</strong><br>
                    <span style="font-size:0.7rem; color:#777;">${key}</span>
                </div>
                <div style="flex:1; text-align:center;">
                    <span style="font-weight:600;">${vendidos}</span> / ${ESTOQUE_MAX}
                </div>
                <div style="flex:2;">
                    <div class="progress-bar"><div class="progress-fill" style="width: ${percent}%;"></div></div>
                </div>
                <div>
                    <button class="btn btn-pequeno btn-outline" onclick="zerarEstoqueItem('${key}')" style="padding:5px 10px;">Zerar</button>
                </div>
            `;
            lista.appendChild(item);
        });

        container.appendChild(lista);
    }

    window.zerarEstoqueItem = function(key) {
        let estoque = JSON.parse(localStorage.getItem(STORAGE_ESTOQUE)) || {};
        delete estoque[key];
        localStorage.setItem(STORAGE_ESTOQUE, JSON.stringify(estoque));
        mostrarNotificacao(`Estoque de ${key} zerado`);
        renderizarEstoque();
        renderizarProdutos(); // atualiza badges
    };

    window.resetarEstoqueGlobal = function() {
        if (confirm('Zerar TODOS os itens vendidos?')) {
            localStorage.setItem(STORAGE_ESTOQUE, JSON.stringify({}));
            mostrarNotificacao('Todos os estoques foram zerados');
            renderizarEstoque();
            renderizarProdutos();
        }
    };

    // ---------- PEDIDOS ----------
    function renderizarPedidos() {
        const pedidos = JSON.parse(localStorage.getItem(STORAGE_PEDIDOS)) || [];
        const container = document.getElementById('pedidosContainer');
        container.innerHTML = '';

        if (pedidos.length === 0) {
            container.innerHTML = '<div style="background:white; padding:30px; text-align:center; border-radius:16px; color:#777;">Nenhum pedido registrado ainda.</div>';
            return;
        }

        pedidos.sort((a,b) => new Date(b.data) - new Date(a.data)).forEach(ped => {
            const card = document.createElement('div');
            card.className = 'pedido-card';
            const data = new Date(ped.data).toLocaleString('pt-BR');
            card.innerHTML = `
                <div class="pedido-header">
                    <span><strong>${ped.cliente}</strong> ¬∑ ${data}</span>
                    <span class="status ${ped.status || 'pendente'}">${ped.status || 'pendente'}</span>
                </div>
                <div style="font-size:0.85rem; margin-bottom:10px;">
                    Pagamento: ${ped.pagamento} ¬∑ Total: R$ ${ped.total.toFixed(2)}
                </div>
                <div style="background: var(--bege-claro); padding:10px; border-radius:8px; font-size:0.8rem;">
                    ${ped.itens.map(i => `‚Ä¢ ${i}`).join('<br>')}
                </div>
                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:15px;">
                    <button class="btn btn-pequeno btn-outline" onclick="mudarStatusPedido('${ped.id}', 'concluido')">‚úì Concluir</button>
                    <button class="btn btn-pequeno" style="background:var(--esgotado);" onclick="removerPedido('${ped.id}')">Remover</button>
                </div>
            `;
            container.appendChild(card);
        });
    }

    window.adicionarPedidoExemplo = function() {
        const pedidos = JSON.parse(localStorage.getItem(STORAGE_PEDIDOS)) || [];
        const novoPedido = {
            id: Date.now().toString(),
            cliente: 'Cliente Exemplo',
            pagamento: 'Pix',
            total: 45.00,
            itens: ['2x Trufa M√©dia (Maracuj√°)', '1x Bolo Ninho & Nutella'],
            data: new Date().toISOString(),
            status: 'pendente'
        };
        pedidos.push(novoPedido);
        localStorage.setItem(STORAGE_PEDIDOS, JSON.stringify(pedidos));
        renderizarPedidos();
        mostrarNotificacao('Pedido de exemplo adicionado');
    };

    window.mudarStatusPedido = function(id, status) {
        let pedidos = JSON.parse(localStorage.getItem(STORAGE_PEDIDOS)) || [];
        const index = pedidos.findIndex(p => p.id === id);
        if (index !== -1) {
            pedidos[index].status = status;
            localStorage.setItem(STORAGE_PEDIDOS, JSON.stringify(pedidos));
            renderizarPedidos();
            mostrarNotificacao(`Status alterado para ${status}`);
        }
    };

    window.removerPedido = function(id) {
        if (confirm('Remover este pedido?')) {
            let pedidos = JSON.parse(localStorage.getItem(STORAGE_PEDIDOS)) || [];
            pedidos = pedidos.filter(p => p.id !== id);
            localStorage.setItem(STORAGE_PEDIDOS, JSON.stringify(pedidos));
            renderizarPedidos();
            mostrarNotificacao('Pedido removido');
        }
    };

    // ---------- CONFIGURA√á√ïES ----------
    window.salvarConfiguracoes = function() {
        const novoMax = parseInt(document.getElementById('estoqueMaximoInput').value, 10);
        if (novoMax > 0) {
            ESTOQUE_MAX = novoMax;
            localStorage.setItem(STORAGE_CONFIG, JSON.stringify({ estoqueMax: novoMax }));
            mostrarNotificacao(`Limite de estoque alterado para ${novoMax}`);
            renderizarProdutos();
            renderizarEstoque();
        }
    };

    window.resetarTudo = function() {
        if (confirm('‚ö†Ô∏è Isso ir√° apagar TODOS os produtos, estoque e pedidos. Tem certeza?')) {
            localStorage.removeItem(STORAGE_PRODUTOS);
            localStorage.removeItem(STORAGE_ESTOQUE);
            localStorage.removeItem(STORAGE_PEDIDOS);
            localStorage.removeItem(STORAGE_CONFIG);
            inicializarDados();
            mostrarNotificacao('Todos os dados foram resetados');
        }
    };

    // ---------- NAVEGA√á√ÉO ----------
    window.mudarSecao = function(secao) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(`secao${secao.charAt(0).toUpperCase() + secao.slice(1)}`).classList.add('active');

        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(`nav${secao.charAt(0).toUpperCase() + secao.slice(1)}`).classList.add('active');

        // Recarregar dados ao entrar na se√ß√£o
        if (secao === 'produtos') renderizarProdutos();
        if (secao === 'estoque') renderizarEstoque();
        if (secao === 'pedidos') renderizarPedidos();
    }

    // ---------- START ----------
    window.onload = function() {
        inicializarDados();

        // Fechar modal clicando fora
        window.onclick = function(event) {
            const modal = document.getElementById('modalProduto');
            if (event.target === modal) modal.style.display = 'none';
        };
    };
</script>
</body>
</html>
